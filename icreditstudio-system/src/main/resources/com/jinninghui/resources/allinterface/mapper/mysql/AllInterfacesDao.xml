<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.jinninghui.icreditdatasphere.icreditstudio.modules.system.allinterface.mapper.AllInterfacesDao">


    <select id="getFlowableApproveGroupInfoByGroupIds"
            resultType="com.jinninghui.icreditdatasphere.icreditstudio.modules.system.allinterface.result.SelectInfoResult">

        SELECT id, NAME
        FROM
            (
                SELECT  a.ID, a.ROLE_NAME NAME FROM ge_role a
                UNION ALL
                SELECT  b.ID,  b.ORG_NAME NAME FROM ge_organization b
                UNION ALL
                SELECT  c.ID,  c.USER_NAME NAME FROM ge_user c
            ) t

            <where>

                <if test="ids != null and ids.size() > 0">
                    AND t.id IN
                    <foreach collection="ids" item="item" open="(" separator="," close=")">
                        #{item, jdbcType=VARCHAR}
                    </foreach>
                </if>

            </where>

    </select>
    <select id="getFlowableApproveUserInfoByGroupIds"
            resultType="com.jinninghui.icreditdatasphere.icreditstudio.modules.system.allinterface.result.SelectInfoResult">
        SELECT DISTINCT
            a.id,
            a.USER_NAME NAME
        FROM
            ge_user a
                LEFT JOIN ge_user_role_map b ON a.ID = b.USER_ID
                LEFT JOIN ge_user_org_map c ON a.ID = c.USER_ID
        <where>
            <if test="ids != null and ids.size() > 0">
                (
                b.ROLE_ID IN
                <foreach collection="ids" item="item" open="(" separator="," close=")">
                    #{item, jdbcType=VARCHAR}
                </foreach>
                OR
                c.ORG_ID IN
                <foreach collection="ids" item="item" open="(" separator="," close=")">
                    #{item, jdbcType=VARCHAR}
                </foreach>
                OR
                a.ID IN
                <foreach collection="ids" item="item" open="(" separator="," close=")">
                    #{item, jdbcType=VARCHAR}
                </foreach>
                 )
            </if>

        </where>

    </select>
    <select id="getFlowableApproveGroupInfoByUserIds"
            resultType="com.jinninghui.icreditdatasphere.icreditstudio.modules.system.allinterface.result.SelectInfoResult">
        SELECT
            a.id,
            a.ROLE_NAME NAME
        FROM
            ge_role a
                LEFT JOIN ge_user_role_map b ON a.ID = b.ROLE_ID
            <where>
                <if test="ids != null and ids.size() > 0">
                    AND b.USER_ID IN
                    <foreach collection="ids" item="item" open="(" separator="," close=")">
                        #{item, jdbcType=VARCHAR}
                    </foreach>
                </if>
            </where>
        UNION ALL
        SELECT
            d.id,
            d.ORG_NAME NAME
        FROM
            ge_organization d
                LEFT JOIN ge_user_org_map e ON d.ID = e.ORG_ID
            <where>
                <if test="ids != null and ids.size() > 0">
                    AND e.USER_ID IN
                    <foreach collection="ids" item="item" open="(" separator="," close=")">
                        #{item, jdbcType=VARCHAR}
                    </foreach>
                </if>
            </where>
        UNION ALL
        SELECT
            f.id,
            f.USER_NAME NAME
        FROM
        ge_user f

            <where>
                <if test="ids != null and ids.size() > 0">
                    AND f.ID IN
                    <foreach collection="ids" item="item" open="(" separator="," close=")">
                        #{item, jdbcType=VARCHAR}
                    </foreach>
                </if>
            </where>


    </select>
    <select id="getFlowableUserGroupMapByUserIds"
            resultType="com.jinninghui.icreditdatasphere.icreditstudio.modules.system.allinterface.result.UserGroupMapResult">
        SELECT
            b.ID,
            b.USER_ID,
            b.ROLE_ID groupId
        FROM
            ge_user_role_map b
                LEFT JOIN ge_user c ON c.ID = b.USER_ID

        <where>
            <if test="ids != null and ids.size() > 0">
                AND b.USER_ID IN
                <foreach collection="ids" item="item" open="(" separator="," close=")">
                    #{item, jdbcType=VARCHAR}
                </foreach>
            </if>
        </where>
        UNION ALL
        SELECT
            b.ID,
            b.USER_ID,
            b.ORG_ID groupId
        FROM
            ge_user_org_map b
                LEFT JOIN ge_user c ON c.ID = b.USER_ID
        <where>
            <if test="ids != null and ids.size() > 0">
                AND b.USER_ID IN
                <foreach collection="ids" item="item" open="(" separator="," close=")">
                    #{item, jdbcType=VARCHAR}
                </foreach>
            </if>
        </where>
        UNION ALL
        SELECT
            b.ID,
            b.ID USER_ID,
            b.ID  groupId
        FROM
        ge_user b
        <where>
            <if test="ids != null and ids.size() > 0">
                AND b.ID IN
                <foreach collection="ids" item="item" open="(" separator="," close=")">
                    #{item, jdbcType=VARCHAR}
                </foreach>
            </if>
        </where>

    </select>
    <select id="getFlowableUserGroupMapByGroupIds"
            resultType="com.jinninghui.icreditdatasphere.icreditstudio.modules.system.allinterface.result.UserGroupMapResult">

        SELECT
            b.ID,
            b.USER_ID,
            b.ROLE_ID  groupId
        FROM
            ge_user_role_map b
                LEFT JOIN ge_user c ON c.ID = b.USER_ID
        <where>
            <if test="ids != null and ids.size() > 0">
                AND b.ROLE_ID IN
                <foreach collection="ids" item="item" open="(" separator="," close=")">
                    #{item, jdbcType=VARCHAR}
                </foreach>
            </if>
        </where>
        UNION ALL
        SELECT
            b.ID,
            b.USER_ID,
            b.ORG_ID groupId
        FROM
            ge_user_org_map b
                LEFT JOIN ge_user c ON c.ID = b.USER_ID
        <where>
            <if test="ids != null and ids.size() > 0">
                AND b.ORG_ID IN
                <foreach collection="ids" item="item" open="(" separator="," close=")">
                    #{item, jdbcType=VARCHAR}
                </foreach>
            </if>
        </where>
        UNION ALL
        SELECT
            b.ID,
            b.ID USER_ID,
            b.ID groupId
        FROM
        ge_user b
        <where>
            <if test="ids != null and ids.size() > 0">
                AND b.ID IN
                <foreach collection="ids" item="item" open="(" separator="," close=")">
                    #{item, jdbcType=VARCHAR}
                </foreach>
            </if>
        </where>

    </select>
    <select id="getRoleInfoByUserId" resultType="com.jinninghui.icreditdatasphere.icreditstudio.modules.system.role.entity.RoleEntity">
        SELECT
        g.*
        FROM
        ge_role g
        LEFT JOIN ge_user_role_map m ON m.role_ID = g.id
        LEFT JOIN ge_user u ON m.USER_ID = u.id
        <where>
            <if test="userId != null and userId != '' ">
                AND  u.ID = #{userId}
            </if>
            <if test="deleteFlag != null and deleteFlag != '' ">
                AND u.DELETE_FLAG =  #{deleteFlag}
            </if>
        </where>


    </select>
    <select id="getOrgInfoByUserId" resultType="com.jinninghui.icreditdatasphere.icreditstudio.modules.system.org.entity.OrganizationEntity">
        SELECT
        g.*
        FROM
        ge_organization g
        LEFT JOIN ge_user_org_map m ON m.ORG_ID = g.id
        LEFT JOIN ge_user u ON m.USER_ID = u.id

        <where>
            <if test="userId != null and userId != '' ">
                AND  u.ID = #{userId}
            </if>
            <if test="deleteFlag != null and deleteFlag != '' ">
                AND u.DELETE_FLAG =  #{deleteFlag}
            </if>
        </where>


    </select>


</mapper>
